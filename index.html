<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
<title>TETRIS Login</title>
<script src="jquery.js"></script>
<style> 
body{
  margin:0 auto; background-color: #333;
  font-size: 20px;
  font-family: "Lucida Console", Courier, monospace;
}
.label {
  width: 100%; 
  display:block;
}
input{
  border: 1px solid #ccc!important;
  border-radius: 5px;
  padding-top: 10px; 
  padding-bottom: 10px; 
  padding-left: 10px; 
  padding-right: 0px;
  margin-left:10px;
  font-size: 18px;
  width: 90%; 
  display:block;
}
.login {
  color:#FFFFFF;
  background: #008000;
  height: 45px;
  width: 94%; 
  display:block;
}
.content{
  text-align: center;
  border: 1px solid #000;
  background-color: #FFF;
}
</style>
<script>
  function debugLocalStorage(){
    console.log("***** START debugLocalStorage *****");
    for (var i = 0; i < localStorage.length; i++){
      console.log(i + ") [localStorage] chiave: " + localStorage.key(i) + " - valore: " + localStorage.getItem(localStorage.key(i)));
    }
    console.log("*****  END debugLocalStorage  *****");
  }
  function onSuccess(data, status)
  {
    /*
    onSuccess 
    data.status: A 
    data: {"auth":"OK","token":"OK20200414200639","id":"1","email":"simone.tonni@gmail.com","username":"simone.tonni","status":"A"} 
    OK - data.auth: OK
    */
    console.log("onSuccess");
    console.log("data.status: "+data.status);
    console.log("data: "+ JSON.stringify(data));
    localStorage.setItem("auth", data.auth);
    localStorage.setItem("token", data.token);
    localStorage.setItem("login", data.auth);
    if (data.auth.localeCompare("OK")==0)
    {
      console.log("OK - data.auth: " + data.auth);
      window.location = "game.html";
    }
    else
    {
      console.log("NOK - data.auth: " + data.auth);
      alert("NOK - data.auth: " + data.auth);
    }
  }
  function onError(data, status)
  {
    //var htmlString = "<p>ERRORE Login!</p>";
    console.log("onError");
    console.log("data.status: "+data.status);
    console.log("data: "+ JSON.stringify(data));
  }   

  $(document).ready(function() {

    var audio = new Audio('assets/audio/tetrisTheme.mp3');
    audio.play();

    //BOTTONE ACCEDI PER EFFETTUARE IL LOGIN:
    $("#btn_login").click(function(){
        if ($("#email").val() != "" && $("#psw").val() != "") {
            console.log("EMAIL=["+$("#email").val()+"]");
            console.log("PSW=["+$("#psw").val()+"]");
            localStorage.setItem("email", $("#email").val() );
            localStorage.setItem("psw", $("#psw").val() );
            //http://www.linkin.it/Projects/TETRIS/TetrisLogin.php?email=simone.tonni@gmail.com&psw=tonni
            $.ajax({    url : "http://www.linkin.it/Projects/TETRIS/TetrisLogin.php",
              cache : false,
              dataType : "json",
              data : { email : $("#email").val(), psw: $("#psw").val()},
              success: onSuccess,
              error: onError
            });            
        } else {
            alert("Inserire Login e Password.");
        }
    });

  });  

  debugLocalStorage();

</script>
</head>
<body>
  <div class="content" style="width:340px; height:580px;" >
    <h1 style='margin-bottom:0;' >TETRIS<br>
        <img src="icon.png" alt="Icon" id="icon">
    </h1>
    <form id="callAjaxForm">
      <div class="container">
        <label class='label' for="email"><b>E-mail address</b></label>
        <input type="text" placeholder="Enter Email" name="email" id="email" required>
        <br>
        <label class='label' for="psw"><b>Password</b></label>
        <input type="password" placeholder="Enter Password" name="psw" id="psw" required>
        <br>
        <!-- <label> <input type="checkbox" checked="checked" name="remember" /> Remember me </label> -->
    	<input type='button' class='login' id='btn_login' value='Login' />
      </div>
      <div class="container">
    	<br>
        <a href="#">Registration</a>
    	<br>
    	<br>
        <a href="#">Forgot password?</a>
      </div>
    </form>
  </div>
</body>
</html>